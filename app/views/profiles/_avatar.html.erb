<p class="control-group">
    <b class="control-label">上传头像</b>
    <input id="uploadify" name="uploadify" type="file" />
</p>
<script type="text/javascript" language="javascript" charset="utf-8">
//<![CDATA[
  $(document).ready(function() {
  <% key = Rails.application.config.session_options[:key] %>
  uploadify_script_data[csrf_param] = encodeURI(encodeURIComponent(csrf_token));
  var upload_params = {
      '#{key}' : '#{cookies[key]}',
      '#{request_forgery_protection_token}' : '#{form_authenticity_token}',
      '_http_accept': 'application/javascript'
    };
  var url = $('input#avatar_image').attr('rel');
   $('input#avatar_image').uploadify({
      'uploader'     : '/assets/uploadify.swf',
      'script'       : url,
      'fileDataName' : 'photo[image]',
      'fileExt'      : '*.png;*.jpg;*.gif',
      'cancelImg'    : '/images/cancel.png',
      'multi'        : true,
      'scriptData'   : upload_params,
      'auto'         : true,
      'onComplete'   : function(e, id, obj, response, data) {
        $('#photos').append(response);
     }
  });
});
//]]>
</script>
